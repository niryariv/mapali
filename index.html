<html>
<head>
    <title>Mapa.li</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <h1>Add Image</h1>

    <input type="file" id="files"/>
    <div style="width:300px;" id="preview"></div>

    
    <form method="POST" action="/submit_form/">
        <input type="hidden" id="image_url" name="image_url" value="" />
        <br />
        <textarea id="description" name="description" rows="5"></textarea>
        <br />
        <input type="submit" value="Update profile" />
    </form>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="/mapali/static/js/lodash.min.js"></script>
    <script type="text/javascript" src="/mapali/static/js/s3upload.js"></script>

    <script type="text/javascript">
    function s3_upload(){
        var s3upload = new S3Upload({
            file_dom_selector: '#files',
            s3_sign_put_url: 'http://mapali.herokuapp.com/sign_s3/',
            onProgress: function(percent, message) {
                $('#status').html('Upload progress: ' + percent + '% ' + message);
            },
            onFinishS3Put: function(public_url) {
                $('#status').html('Upload completed. Uploaded to: '+ public_url);
                $("#image_url").val(public_url);
                $("#preview").html('<img src="'+public_url+'" style="width:300px;" />');
            },
            onError: function(status) {
                $('#status').html('Upload error: ' + status);
            }
        });
    }

    $().ready(function() {
        $('#files').on("change", s3_upload);
    });
    </script>
</body>
</html>
